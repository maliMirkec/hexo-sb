<p><a href="https://npmjs.com/package/starter-project-cli">SPRO</a> is a boilerplate of predefined Gulp tasks. The mission is to set up the development environment for your project without writing Gulp tasks again and again. In this article, I am going to show you how to configure SPRO for custom WordPress theme development.</p>
<!-- more -->
<p>If you want to learn more about SPRO, <a href="/articles/introducing-spro/">read the introduction article from the last week</a>.</p>
<h2>The Video Lesson</h2>
<p>If you prefer watching a video over reading an article, you could proceed to <a href="https://skl.sh/2EcUlRt">the Skillshare lesson</a> that I recorded for this occasion.</p>
<p><a href="https://skl.sh/2EcUlRt">&gt; {cldnry cover-wp_w0q90l.jpg &quot;SPRO Skillshare course cover.&quot; %}</a></p>
<h2>The project structure</h2>
<p>I am going to use a default WordPress installation as my starting point. I am using <a href="https://local.getflywheel.com/">Local by FlyWheel</a> as my WordPress development tool.</p>
<blockquote>
<p>{cldnry local_hu1z2y.jpg &quot;Screenshot of Local by FlyWheel tool.&quot; %}</p>
</blockquote>
<p>The aim is to add Gulp tasks to TwentyNineteen default theme for Sass, JavaScript, BrowserSync, and Critical CSS.</p>
<p>I have reorganized the code in the theme. First, I have created a new folder called <code>css</code> and moved all Sass files and <code>sass</code> folder in it. Next, I have created a new folder called <code>src</code>, and moved newly created <code>css</code> folder and existing <code>js</code> folder in the <code>src</code> folder.</p>
<p>The project structure looks like this:</p>
<pre><code>|-- src
    |   |-- css
    |   |   |-- style.scss
    |   |   |-- ...
    |   |   |-- sass
    |   |       |-- _normalize.scss
    |   |       |-- ...
    |   |-- js
    |       |-- customize-controls.js
    |       |-- ...
</code></pre>
<h2>SPRO installation</h2>
<p>To install SPRO, run <code>npm install starter-project-cli -s</code> command, and then run SPRO by executing <code>node_modules/.bin/spro start</code> command. SPRO is also available <a href="/articles/introducing-spro/#Installation">for global installation</a>. Now you should be prompted to answer questions about the project architecture and Gulp tasks.</p>
<p>Here are my (shortened) answers:</p>
<pre><code>    GENERAL | Do you want to override the project? Yes
    GENERAL | What is the root folder of the project? ./
    GENERAL | Where is the folder with the source code of the project? src
    GENERAL | Where do you want to store compiled code of the project? build
    GENERAL | Are you sure that you want to override the project? Yes
BROWSERSYNC | Do you want to run BrowserSync to preview changes in the browser? Yes
       HTML | Do you want to run HTML tasks? No
        CSS | Do you want to run CSS tasks? Yes
        CSS | Are you using Sass? Yes
        CSS | Where is the folder with CSS source code? css
        CSS | Where do you want to store compiled CSS code? css
        CSS | Do you want to minify CSS code? Yes
        CSS | Do you want to autoprefix CSS code? Yes
        CSS | Do you want to add sourcemaps for CSS code? No
        CSS | Do you want to lint CSS code? No
         JS | Do you want to run JavaScript (es6) tasks? Yes
         JS | Where is the folder with JavaScript source code? js
         JS | Where do you want to store compiled JavaScript code? js
         JS | Do you want to minify JavaScript code? Yes
         JS | Do you want to add sourcemaps for JavaScript code? No
         JS | Do you want to lint JavaScript code? No
     IMAGES | Do you want to run image optimization tasks? No
      FONTS | Do you use local fonts? Do you want to run font tasks? No
    FAVICON | Do you want to run favicon tasks? No
   CRITICAL | Do you want to extract Critical CSS? Yes
   COMPRESS | Do you want to compress (gzip) all assets? No
        KSS | Do you want to add KSS style guide? No
    SASSDOC | Do you want to add documentation for the SASS code (SassDoc)? No
      JSDOC | Do you want to add documentation for the JS code (JSDoc)? No
     SEMVER | Do you want to add semver versioning tasks? No
       YARN | Do you use Yarn as your default dependency manager? Yes
</code></pre>
<p>After the installation, SPRO would copy Gulp tasks and configuration files in the <code>gulpfile.js</code> folder.</p>
<p>To be able to run Gulp tasks, we should install all required dependencies. You could find the installation command in your terminal, right after the questions. Paste the command in your terminal, and hit Enter.</p>
<h2>SPRO configuration</h2>
<p>Now that we have all required Gulp tasks and dependencies, we could configure SPRO.</p>
<p>Let's start with BrowserSync. I want to use the BrowserSync to preview the changes in the browser. Local by FlyWheel tool have configured the local site domain for me. In my case, it is <code>spro-wp.v</code>. I am going to use the local domain as a proxy for BrowserSync.</p>
<pre><code>{
  &quot;proxy&quot;: &quot;http://spro-wp.v&quot;
}
</code></pre>
<p>Next, we should update the URL for extracting Critical CSS to match our development domain in the <code>.critical.json</code> file.</p>
<pre><code>[{
  &quot;src&quot;: &quot;style.css&quot;,
  &quot;settings&quot;: {
    &quot;out&quot;: &quot;style.critical.css&quot;,
    &quot;url&quot;: &quot;http://spro-wp.v/&quot;,
    &quot;width&quot;: 1920,
    &quot;height&quot;: 1200,
    &quot;keepLargerMediaQueries&quot;: true,
    &quot;strict&quot;: false,
    &quot;blockJSRequests&quot;: false,
    &quot;phantomJsOptions&quot;: {
      &quot;ssl-protocol&quot;: &quot;any&quot;,
      &quot;ignore-ssl-errors&quot;: true
    }
  }
}]
</code></pre>
<p>There are other options here, but the most important ones are <code>src</code> and <code>out</code> options. <code>src</code> option tells which file to use as our source file for extracting Critical CSS, and <code>out</code> option tells in which file should Penthouse store the extracted Critical CSS code. To learn more about Penthouse, <a href="https://github.com/pocketjoso/penthouse">visit the official Penthouse site</a>.</p>
<p>Also, we should create a new Sass file in the <code>sass</code> folder called <code>style.critical.scss</code>.</p>
<h2>Running the tasks</h2>
<p>To view the list of available Gulp tasks, run <code>gulp --tasks</code> command. We have four tasks:</p>
<ul>
<li><code>clean</code> for cleaning the compiled code, and</li>
<li>three tasks for development: <code>dev</code>, <code>build</code>, and <code>default</code>.</li>
</ul>
<p>If you run <code>default</code> Gulp task, the site should open in the browser.</p>
<h2>PHP updates</h2>
<p>Since our compiled code is stored in the <code>build</code> folder, we should update the path for CSS and JavaScript files. In the <code>functions.php</code> file, update the <code>twentynineteen_scripts</code> function:</p>
<pre><code>&lt;?php
/**
 * Enqueue scripts and styles.
 */
function twentynineteen_scripts() {
  // Will load CSS file at the end of the page
  // wp_enqueue_style( 'twentynineteen-style', get_stylesheet_uri(), array(), wp_get_theme()-&gt;get( 'Version' ) );

  wp_style_add_data( 'twentynineteen-style', 'rtl', 'replace' );

  // Will update the path to the JavaScript files
  if ( has_nav_menu( 'menu-1' ) ) {
    wp_enqueue_script( 'twentynineteen-priority-menu', get_theme_file_uri( '/build/js/priority-menu.js' ), array(), '1.1', true );
    wp_enqueue_script( 'twentynineteen-touch-navigation', get_theme_file_uri( '/build/js/touch-keyboard-navigation.js' ), array(), '1.1', true );
  }

  // Will update the path to the print CSS file
  wp_enqueue_style( 'twentynineteen-print-style', get_template_directory_uri() . '/build/css/print.css', array(), wp_get_theme()-&gt;get( 'Version' ), 'print' );

  if ( is_singular() &amp;&amp; comments_open() &amp;&amp; get_option( 'thread_comments' ) ) {
    wp_enqueue_script( 'comment-reply' );
  }
}
?&gt;
</code></pre>
<p>We are removing the main style file, and we are updating the path to the JavaScript and the print CSS files.</p>
<p>In the <code>footer.php</code> file, add a link to the main style file just before the closing body tag:</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;&lt;?php echo get_theme_file_uri('/build/css/style.css'); ?&gt;&quot;&gt;
</code></pre>
<p>Ideally, we should defer the loading of the uncritical CSS file, <a href="https://developers.google.com/web/tools/lighthouse/audits/unused-css#deferring">as suggested by Google</a>.</p>
<h2>Critical CSS</h2>
<p>Next, let's inline Critical CSS in the head of the HTML document, in the <code>header.php</code> file.</p>
<pre><code>&lt;?php
$critical = get_template_directory() . '/build/css/style.critical.css';
if ( file_exists( $critical ) ) {
  echo '&lt;style&gt;';
  require_once $critical;
  echo '&lt;/style&gt;';
}
?&gt;
</code></pre>
<p>If you followed the instructions correctly, you should be able to run <code>gulp</code> command in your terminal. Gulp should compile the code, then open the site in the browser, then extract the Critical CSS and then refresh the browser.</p>
<h2>Conclusion</h2>
<p>As you could see, I have never touched any of the Gulp tasks, just configuration file. This is exactly what SPRO is all about.</p>
<p>If you have any feedback, it would be appreciated. SPRO is in its early stages, and more features could be added soon.</p>
<p>Please spread the word. More lessons are coming soon! ðŸ“£</p>
